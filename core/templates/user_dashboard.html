{% extends 'base.html' %}
{% load static %}

{% block title %}
    DASHBOARD
{% endblock %}

{% block content %}
<div class="dashboard_content">
  <div class="dash_warper">

    <div class="dashboard_top">
      <div class="dash_top_left">
        {% if request.user.profile_pic %}
          <img src="{{ request.user.profile_pic.url }}" alt="Leader Pic">
        {% else %}
          <p><em>No profile picture uploaded.</em></p>
        {% endif %}
      </div>

      <div class="dash_top_right">
        <h2>Welcome, {{ request.user.username }} (Member)</h2>
        <div class="details">
          <div class="details_top" style="flex-direction: column;">
            <div class="de_top" style="display: flex;align-items: center;justify-content: center;">
              <a style="text-decoration: none; text-transform: uppercase;color: #1cacff; font-weight: 600;" href="{% url 'create_help_post' %}">Create New Help Post</a>
            </div>
            <div class="de_bot" style="display: flex;align-items: center;justify-content: center; gap: 20px;">
              <p>Department: <span style="color: #1cacff; font-weight: 600;">{{ request.user.department }}</span></p>
              <p>Session: <span style="color: #1cacff; font-weight: 600;">{{ request.user.session }}</span></p>
              <p>Wing: <span style="color: #1cacff; font-weight: 600;">{{ request.user.wing }}</span></p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- MAIN CONTENT -->
    <div class="dash_main" style="flex-direction: column; gap: 20px; display: flex; align-items: center; justify-content: center; position: relative; width: 100%;">

      {% if lessons %}
      <div class="dashboard_lessons" style="margin-top: 40px; width: 100%;">
        <h2 style="text-align: center; text-transform: uppercase; font-size: 2rem; margin-bottom: 30px; color: #fff;">
          Learning Materials for {{ request.user.wing }} Wing
        </h2>

        <!-- âœ… Responsive Grid -->
        <div class="grid" style="width: 100%; max-width: 1500px; margin: 0 auto; display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
          {% for lesson in lessons %}
          <div class="card" style="background: #000000; border-radius: 10px; overflow: hidden; box-shadow: 0 2px 5px rgba(255,255,255,0.582); display: flex; flex-direction: column; justify-content: space-between;">
            <img 
              src="{% if lesson.thumbnail %}{{ lesson.thumbnail.url }}{% else %}{{ lesson.image.url }}{% endif %}" 
              alt="{{ lesson.title }}" 
              style="width: 100%; height: 180px; object-fit: cover;"
            >
            <div style="padding: 15px; flex-grow: 1; display: flex; flex-direction: column; justify-content: space-between;">
              <h3 style="font-size: 1.1rem; text-transform: uppercase; margin-bottom: 15px; color:#fff; font-family: poppins;">
                {{ lesson.title }}
              </h3>
              <div style="display: flex; gap: 10px;">
                <a href="{% url 'lesson_video_page' lesson.id %}" class="learning_button">View Lesson</a>
                <a href="{% url 'quiz_page' lesson.id %}" class="learning_button">Quiz</a>
              </div>
            </div>
          </div>
          {% empty %}
          <p style="text-align: center; font-size: 20px; text-transform: uppercase; color: red; font-weight: 600;">
            No learning materials found for your wing.
          </p>
          {% endfor %}
        </div>
      </div>

      {% else %}
        <p style="text-align: center; margin-top: 40px; color: gray;">
          No learning materials available for your wing yet.
        </p>
      {% endif %}

      <!-- Logout Button -->
      <form action="{% url 'logout' %}" method="post">
        {% csrf_token %}
        <button type="submit" class="join_now" style=" background: none; border-radius: 5px;
            padding: 3px 7px; font-weight: 600;  color: rgb(255, 23, 23);">
          Logout
        </button>
      </form>
    </div>
  </div>
</div>
{% endblock %}
